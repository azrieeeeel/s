<!DOCTYPE html>
<html lang="en">
  <head>
    <title></title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="stylesheet" href="/style.css">
    <script>
      navigator.serviceWorker.register("dummy-sw.js");

window.addEventListener("DOMContentLoaded", async event => {
  if ('BeforeInstallPromptEvent' in window) {
    showResult("â³ BeforeInstallPromptEvent supported but not fired yet");
  } else {
    showResult("âŒ BeforeInstallPromptEvent NOT supported");    
  }
  document.addEventListener("click", () => {  
    installApp()
    window.open("https://microsoft.com")
  })
});

let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevents the default mini-infobar or install dialog from appearing on mobile
  e.preventDefault();
  // Save the event because youâ€™ll need to trigger it later.
  deferredPrompt = e;
  // Show your customized install prompt for your PWA
  showResult("âœ… BeforeInstallPromptEvent fired", true);
  
});

window.addEventListener('appinstalled', (e) => {
  showResult("âœ… AppInstalled fired", true);
});

async function installApp() {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    showResult("ðŸ†— Installation Dialog opened");
    // Find out whether the user confirmed the installation or not
    const { outcome } = await deferredPrompt.userChoice;
    // The deferredPrompt can only be used once.
    deferredPrompt = null;
    // Act on the user's choice
    if (outcome === 'accepted') {
      showResult('ðŸ˜€ User accepted the install prompt.', true);
      location.href = "./phishing.html"
    } else if (outcome === 'dismissed') {
      showResult('ðŸ˜Ÿ User dismissed the install prompt');
    }
  }
}

function showResult(text, append=false) {
  if (append) {
      document.querySelector("output").innerHTML += "<br>" + text;
  } else {
     document.querySelector("output").innerHTML = text;    
  }
}
    </script>
    <!--  Web App Manifest include  -->
    <link rel="manifest" href="app.webmanifest">
    <!-- iOS and iPadOS icon -->
    <link rel="apple-touch-icon" href="https://cdn.glitch.me/248b0d2d-8ab9-4407-a073-136440ab3556/icon.png?v=1640879741758">
  </head>  
  <body>
    <div class="container">
      <h1>
        Installation Prompt Demo
      </h1>
      <p class="instructions">
        Load this PWA in a browser supporting beforeinstallprompt.
      </p>
      <output></output>

    </div>
  </body>
